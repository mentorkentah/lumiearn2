<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin User Table - LUMIEARN</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
<style>
body{font-family:'Orbitron',sans-serif;background:#0a0a0f;color:#fff;padding:20px;}
h2{margin-bottom:10px;}
.search-box{margin-bottom:15px;}
.search-box input{width:300px;padding:8px 12px;border-radius:6px;border:1px solid #00fff0;background:#111118;color:#fff;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th, td{border:1px solid #00fff0;padding:12px;text-align:center;}
th{background:#111118;color:#00fff0;}
tr:nth-child(even){background:#111118;}
button{padding:6px 12px;background:#00fff0;color:#0a0a0f;border:none;border-radius:6px;cursor:pointer;}
button:hover{background:#00d1c9;}
.pagination{margin-top:15px;display:flex;justify-content:space-between;align-items:center;}
.pagination button{padding:4px 10px;margin:0 2px;}
</style>
</head>
<body>

<h2>Users List</h2>
<div class="search-box">
  <input type="text" id="searchInput" placeholder="Search by username or email..." onkeyup="searchUsers()">
</div>

<table id="userTable">
  <thead>
    <tr>
      <th>SN</th>
      <th>Username</th>
      <th>Email</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination">
  <div id="totalUsers">Total Active Users: 0</div>
  <div>
    <button onclick="prevPage()">Prev</button>
    <span id="pageInfo">Page 1 of 1</span>
    <button onclick="nextPage()">Next</button>
  </div>
</div>

<script>
// --- Configuration ---
const rowsPerPage = 15;
let currentPage = 1;
let filteredUsers = [];

// --- Load users from localStorage ---
function getAllUsers() {
  const users = [];
  Object.keys(localStorage).forEach(k => {
    if(k.startsWith("LUMIEARN_USER_")) {
      const user = JSON.parse(localStorage.getItem(k));
      users.push(user);
    }
  });
  return users;
}

// --- Render Table ---
function renderTable(page = 1){
  const tbody = document.getElementById("userTable").querySelector("tbody");
  tbody.innerHTML = "";
  
  const totalUsers = filteredUsers.length;
  document.getElementById("totalUsers").textContent = `Total Active Users: ${totalUsers}`;

  const totalPages = Math.ceil(totalUsers / rowsPerPage);
  if(page > totalPages) page = totalPages;
  if(page < 1) page = 1;
  currentPage = page;

  const start = (page-1)*rowsPerPage;
  const end = start + rowsPerPage;
  const pageUsers = filteredUsers.slice(start, end);

  let sn = start+1;
  pageUsers.forEach(user=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${sn}</td>
      <td>${user.username}</td>
      <td>${user.email || ""}</td>
      <td>
        <button onclick="goToUpdate('${encodeURIComponent(user.username)}')">Update</button>
      </td>
    `;
    tbody.appendChild(tr);
    sn++;
  });

  if(pageUsers.length === 0){
    tbody.innerHTML = '<tr><td colspan="4">No users found</td></tr>';
  }

  document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${totalPages || 1}`;
}

// --- Search Function ---
function searchUsers(){
  const term = document.getElementById("searchInput").value.toLowerCase();
  const allUsers = getAllUsers();
  filteredUsers = allUsers.filter(u=> 
    u.username.toLowerCase().includes(term) || 
    (u.email && u.email.toLowerCase().includes(term))
  );
  currentPage = 1;
  renderTable(currentPage);
}

// --- Pagination ---
function prevPage(){ if(currentPage>1) renderTable(currentPage-1); }
function nextPage(){ 
  const totalPages = Math.ceil(filteredUsers.length / rowsPerPage);
  if(currentPage<totalPages) renderTable(currentPage+1); 
}

// --- Redirect to update page ---
// Pass the username as URL parameter 'user', which will be read by the update page
function goToUpdate(username){
  window.location.href = `http://localhost:8158/users-info.html?user=${username}`;
}

// --- Initialize ---
filteredUsers = getAllUsers();
renderTable(currentPage);
</script>

</body>
</html>